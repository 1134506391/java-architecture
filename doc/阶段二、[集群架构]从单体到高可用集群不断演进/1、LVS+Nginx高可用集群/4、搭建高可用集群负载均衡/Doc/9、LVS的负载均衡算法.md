# LVS的负载均衡算法

## 1、静态算法

静态算法: 根据LVS本身自由的固定的算法分发用户请求;

1. 轮询(rr): 调度器将请求平均分配给每个真实服务器;

2. 加权轮询(wrr)：按权重分配用户请求(和nginx权重一样);

3. 原地址散列(sh)：同一个用户的请求,会由同一个RS来处理(Nginx的ip_hash)；

4. 目标地址散列(dh)： 根据url不同，请求到不同RS真实服务器(Nginx的url_hash);

## 2、动态算法

动态算法: 根据流量不同，或者服务器压力来分配用户请求，动态计算

1. 最小连接数(lc): 把新的连接请求分配到当前连接数最小的服务器；

2. 加权数最少连接数(Weight Least Connections 简写 wlc): 服务器的处理性能用数值来代表，权重越大的请求越多。Real Server有可能会存在性能上的差异，wlc动态获取不同服务器的负载情况，将请求分发到性能较好并且比较空闲的服务器;（但是LVS这台服务器的会有所损耗）

3. 最短期望延迟(sed)：特殊的wlc算法。

   > 举例阐述，假设有A、B、C三台服务器，权重分别为1、2、3，如果使用wlc算法的话，当一个新请求进来，它可能会分给A、B、C中的任意一个，使用sed算法后会进行如下运算：
   >
   > - A:(1+1)/1=2
   >
   > - B:(1+2)12=3/2
   >
   > - C:(1+3)13=4/3
   >
   >   最终结果，会把这个请求交给得出运算结果最小的服务器

4. 最少队列调度(nq): 永远不使用队列，如果RealServer的连接数等于0,直接把这个请求分配过期，不需要排队等待运算(sed运算)

## 3、总结

使用最多的还是 加权数最少连接数【wlc】和加权轮询【wrr】，简单易用



> 参考文档：http://www.linuxvirtualserver.org/zh/lvs4.html

